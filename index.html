<!doctype html>
<html>

<head>
  <title>App bitalino</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
  <style type="text/css">
    .movement-title {
      font-size: 40px;
    }

    .effect {
      width: 3em;
    }
    /*from https://www.w3schools.com/howto/howto_css_switch.asp*/

    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 24px;
    }
    /* Hide default HTML checkbox */

    .switch input {
      display: none;
    }
    /* The slider */

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      -webkit-transition: .4s;
      transition: .4s;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      -webkit-transition: .4s;
      transition: .4s;
    }

    input:checked+.slider {
      background-color: #2196F3;
    }

    input:focus+.slider {
      box-shadow: 0 0 1px #2196F3;
    }

    input:checked+.slider:before {
      -webkit-transform: translateX(16px);
      -ms-transform: translateX(16px);
      transform: translateX(16px);
    }
    /* Rounded sliders */

    .slider.round {
      border-radius: 34px;
    }

    .slider.round:before {
      border-radius: 50%;
    }
  </style>

</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-sm-12">Area de info e status actual</div>

    </div>
    <div class="row movX">
      <div class="col-sm-4">Movimento X</div>
      <div class="col-sm-4 ">

        <div>
          <label>Cabinet</label>
          <input name="cabinet_level" class="effect" type="text" />
        </div>

        <div>
          <label>Reverb</label>
          <input name="reverb_level" class="effect" type="text" />
        </div>

        <div>
          <label>Volume</label>
          <input name="volume_level" class="effect" type="text" />
        </div>

        <div>
          <label>Delay</label>
          <input name="delay_level" class="effect">
          <label>Delay delay timer</label>
          <input name="delay_timer" class="effect" type="text" />
          <label>Delay feedback gain</label>
          <input name="delay_feedback_gain" class="effect" type="text" />
        </div>

        <div>
          <label>Overdrive</label>
          <input name="overdrive_level" class="effect" type="text" />
          <label>Overdrive drive</label>
          <input name="overdrive_drive" class="effect" type="text" />
          <label>Overdrive tone</label>
          <input name="overdrive_tone" class="effect" type="text" />
        </div>

      </div>
      <div class="col-sm-4">
        <a onclick="doit()">Do it!</a>
        <a onclick="stopit()">Stop it!</a>

      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <button>Apply</button>
        <button onclick="stopbita()">Stop bita</button>
      </div>

    </div>
    <div class="row">
      <div class="col-sm-12">
        <ul class="mylogs">
        </ul>
      </div>



      <div class="col-sm-12">
        <h3>Samples</h3>
      </div>

      <div class="col-sm-6 form-group">
        <div class="panel panel-default">
          <div class="panel-heading">
            <label class="switch">
        <input type="checkbox" />
        <span class="slider round"></span>
      </label>
            <span class="movement-title">Up movement</span>
          </div>
          <div class="panel-body">
            <select id="sampleSelect" class="custom-select">
        <option selected>Select sample</option>
        <option value="url1">One</option>
        <option value="url2">Two</option>
        <option value="url3">Three</option>
      </select>
            <label class="form-check-label">
        <input id="loopCB" class="form-check-input" type="checkbox" value="">loop
      </label>

            <div class="row">
              <div class="col-sm-6">
                <label>Cabinet</label>
                <input name="cabinet_level" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Reverb</label>
                <input name="reverb_level" class="effect" type="number" min="0" max="100" />
              </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                <label>Volume</label>
                <input name="volume_level" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Overdrive</label>
                <input name="overdrive_level" class="effect" type="number" min="0" max="100" />
              </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                <label>Overdrive drive</label>
                <input name="overdrive_drive" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Overdrive tone</label>
                <input name="overdrive_tone" class="effect" type="number" min="0" max="100" />
              </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                <label>Delay timer</label>
                <input name="delay_timer" class="effect" type="number" min="0" max="100" />
              </div>
              <div class="col-sm-6">
                <label>Delay</label>
                <input name="delay_level" class="effect" type="number" min="0" max="100">
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <label>Delay feedback gain</label>
                <input name="delay_feedback_gain" class="effect" type="number" min="0" max="100" />
              </div>
            </div>

          </div>
        </div>
      </div>




      <div class="col-sm-6 form-group">
        <div class="panel panel-default">
          <div class="panel-heading">
            <label class="switch">
            <input type="checkbox" />
            <span class="slider round"></span>
          </label>
            <span class="movement-title">Down movement</span>
          </div>
          <div class="panel-body">
            <select id="sampleSelect" class="custom-select">
            <option selected>Select sample</option>
            <option value="url1">One</option>
            <option value="url2">Two</option>
            <option value="url3">Three</option>
          </select>
            <label class="form-check-label">
            <input id="loopCB" class="form-check-input" type="checkbox" value="">loop
          </label>

            <div class="row">
              <div class="col-sm-6">
                <label>Cabinet</label>
                <input name="cabinet_level" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Reverb</label>
                <input name="reverb_level" class="effect" type="number" min="0" max="100" />
              </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                <label>Volume</label>
                <input name="volume_level" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Overdrive</label>
                <input name="overdrive_level" class="effect" type="number" min="0" max="100" />
              </div>
            </div>


            <div class="row">
              <div class="col-sm-6">
                <label>Overdrive drive</label>
                <input name="overdrive_drive" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Overdrive tone</label>
                <input name="overdrive_tone" class="effect" type="number" min="0" max="100" />
              </div>
            </div>


            <div class="row">
              <div class="col-sm-6">
                <label>Delay timer</label>
                <input name="delay_timer" class="effect" type="number" min="0" max="100" />
              </div>
              <div class="col-sm-6">
                <label>Delay</label>
                <input name="delay_level" class="effect" type="number" min="0" max="100">
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <label>Delay feedback gain</label>
                <input name="delay_feedback_gain" class="effect" type="number" min="0" max="100" />
              </div>
            </div>

          </div>
        </div>
      </div>



      <div class="col-sm-6 form-group">
        <div class="panel panel-default">
          <div class="panel-heading">
            <label class="switch">
                <input type="checkbox" />
                <span class="slider round"></span>
              </label>
            <span class="movement-title">Left movement</span>
          </div>
          <div class="panel-body">
            <select id="sampleSelect" class="custom-select">
                <option selected>Select sample</option>
                <option value="url1">One</option>
                <option value="url2">Two</option>
                <option value="url3">Three</option>
              </select>
            <label class="form-check-label">
                <input id="loopCB" class="form-check-input" type="checkbox" value="">loop
              </label>

            <div class="row">
              <div class="col-sm-6">
                <label>Cabinet</label>
                <input name="cabinet_level" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Reverb</label>
                <input name="reverb_level" class="effect" type="number" min="0" max="100" />
              </div>
            </div>

            <div class="row">
              <div class="col-sm-6">
                <label>Volume</label>
                <input name="volume_level" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Overdrive</label>
                <input name="overdrive_level" class="effect" type="number" min="0" max="100" />
              </div>
            </div>


            <div class="row">
              <div class="col-sm-6">
                <label>Overdrive drive</label>
                <input name="overdrive_drive" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Overdrive tone</label>
                <input name="overdrive_tone" class="effect" type="number" min="0" max="100" />
              </div>
            </div>





            <div class="row">
              <div class="col-sm-6">
                <label>Delay timer</label>
                <input name="delay_timer" class="effect" type="number" min="0" max="100" />
              </div>
              <div class="col-sm-6">
                <label>Delay</label>
                <input name="delay_level" class="effect" type="number" min="0" max="100">
              </div>
            </div>

            <div class="row">
              <div class="col-sm-12">
                <label>Delay feedback gain</label>
                <input name="delay_feedback_gain" class="effect" type="number" min="0" max="100" />
              </div>
            </div>

          </div>
        </div>
      </div>



      <div class="col-sm-6 form-group">
        <div class="panel panel-default">
          <div class="panel-heading">
            <label class="switch">
        <input type="checkbox" />
        <span class="slider round"></span>
      </label>
            <span class="movement-title">Right movement</span>
          </div>
          <div class="panel-body">
            <select id="sampleSelect" class="custom-select">
        <option selected>Select sample</option>
        <option value="url1">One</option>
        <option value="url2">Two</option>
        <option value="url3">Three</option>
      </select>
            <label class="form-check-label">
        <input id="loopCB" class="form-check-input" type="checkbox" value="">loop
      </label>
            <div class="row">
              <div class="col-sm-6">
                <label>Cabinet</label>
                <input name="cabinet_level" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Reverb</label>
                <input name="reverb_level" class="effect" type="number" min="0" max="100" />
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <label>Volume</label>
                <input name="volume_level" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Overdrive</label>
                <input name="overdrive_level" class="effect" type="number" min="0" max="100" />
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <label>Overdrive drive</label>
                <input name="overdrive_drive" class="effect" type="number" min="0" max="100" />
              </div>

              <div class="col-sm-6">
                <label>Overdrive tone</label>
                <input name="overdrive_tone" class="effect" type="number" min="0" max="100" />
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <label>Delay timer</label>
                <input name="delay_timer" class="effect" type="number" min="0" max="100" />
              </div>
              <div class="col-sm-6">
                <label>Delay</label>
                <input name="delay_level" class="effect" type="number" min="0" max="100">
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <label>Delay feedback gain</label>
                <input name="delay_feedback_gain" class="effect" type="number" min="0" max="100" />
              </div>
            </div>

          </div>
        </div>
      </div>








    </div>





    <div class="panel panel-default">
      <div class="panel-heading">Effects</div>
      <div id="effects-panel" class="panel-body">




        <div class="form-check col-sm-2">
          <label class="form-check-label">
        <input id="cabinet" class="form-check-input" type="checkbox" value="Cabinet" />Cabinet
  </label>
        </div>

        <div class="form-check col-sm-2">
          <label class="form-check-label">
        <input id="reverb" class="form-check-input" type="checkbox" value="Reverb" />Reverb
  </label>
        </div>

        <div class="form-check col-sm-2">
          <label class="form-check-label">
        <input id="volume" class="form-check-input" type="checkbox" value="Volume">Volume
  </label>
        </div>

        <div class="form-check col-sm-2">
          <label class="form-check-label">
        <input id="overdrive" class="form-check-input" type="checkbox" value="Overdrive">Overdrive
  </label>
        </div>

        <div class="form-check col-sm-2">
          <label class="form-check-label">
        <input id="overdrivedrive" class="form-check-input" type="checkbox" value="Overdrive drive">Overdrive drive
  </label>
        </div>

        <div class="form-check col-sm-2">
          <label class="form-check-label">
        <input id="overdrivetone" class="form-check-input" type="checkbox" value="Overdrive tone">Overdrive tone
  </label>
        </div>

        <div class="form-check col-sm-2">
          <label class="form-check-label">
        <input id="delaytimer" class="form-check-input" type="checkbox" value="Delay timer" />Delay timer
  </label>
        </div>

        <div class="form-check col-sm-2">
          <label class="form-check-label">
        <input id="delay" class="form-check-input" type="checkbox" value="Delay" />Delay
  </label>
        </div>

        <div class="form-check col-sm-2">
          <label class="form-check-label">
        <input id="delayfeedgain" class="form-check-input" type="checkbox" value="Delay feedback" />Delay feedback gain
  </label>
        </div>


      </div>

    </div>



    <div id="effects-sequence" class="panel panel-default">
      <div class="panel-heading">Effects sequenc</div>
      <div class="panel-body">


      </div>
    </div>
  </div>
</body>
<script src="/node_modules/jquery/dist/jquery.min.js"></script>
<script src="/public/pedalboard.js"></script>
<script src="https://www.doc.gold.ac.uk/eavi/rapidmix/RapidLib.js"></script>

<script>
  // Create an instance of the library
  var rapidMix = window.RapidLib();
  // Create a classification object
  var myClassification = new rapidMix.Classification();

  var demoTrainingSet = [
    {
      input: [0, 0],
      output: [0]
    },
    {
      input: [0, 1],
      output: [1]
    },
    {
      input: [1, 0],
      output: [1]
    },
    {
      input: [1, 1],
      output: [2]
    },
  ];

  //Train the models using the demo training set
  console.log('classification trained: ', myClassification.train(demoTrainingSet));

  // try something
  classificationOutput = myClassification.process([0, 0]);
  console.log('classification output: ', classificationOutput);

</script>

<script>
  var rms = [];
  var lux = [];
  for (var i = 0; i < 250; ++i) { //BITalino server is giving us 250 samples per message
    rms[i] = 0.0;
    lux[i] = 0.0;
  }
  var freq = 0;
  var a1 = [];
  var counter = 0;
  // Establish a connection to the ServerBIT
  var ws = new WebSocket("ws://localhost:9011/");
  var wsOpen = false;

  ws.onopen = function () {
    wsOpen = true;
    console.log("ws opened");
  };

  // Process the responses sent by the ServerBIT
  ws.onmessage = function (e) {
    var data = JSON.parse(e.data);
    //console.log(data.A5);
    if ($('.mylogs li').length > 1) {
      $('.mylogs li').first().remove();
    }

    // 400 +
    // 600 -

    $(".mylogs").append('<li >A3-' + data.A3 + '</li>');

    for (var i = 0; i < data.A3.length; ++i) {
      console.log(data.A3[i]);
      var normalizedValue = (data.A3[i] - 400) / 200;
      console.log(normalizedValue);
      volume.setLevel(normalizedValue);
    }
  };

  // Detect when the page is unloaded or close
  window.onbeforeunload = function () {
    ws.onclose = function () { };
    ws.close();
  };

</script>
<script>
    var stage = new pb.Stage();
    var ctx = stage.getContext();
    var board = new pb.Board(ctx);
    stage.setBoard(board);
    var overdrive = new pb.stomp.Overdrive(ctx);
    var reverb = new pb.stomp.Reverb(ctx);
    var volume = new pb.stomp.Volume(ctx);
    var cabinet = new pb.stomp.Cabinet(ctx);
    var delay = new pb.stomp.Delay(ctx);
    board.addPedals([overdrive, delay, reverb, volume, cabinet]);
    overdrive.setDrive(.1);
    overdrive.setTone(.4);
    overdrive.setLevel(.6);
    volume.setLevel(1);
    reverb.setLevel(.3);
    delay.setDelayTimer(.2);
    delay.setFeedbackGain(.7);

</script>

<script type="text/javascript">
    function doit() {

      var map = {};

      $(".movX .effect").each(function () {
        value = 0;
        console.log(value);
        if ($(this).val() != '') {
          value = $(this).val();
        }
        map[$(this).attr("name")] = value;
      });

      console.log(map);

      cabinet.setLevel(map['cabinet_level'])

      reverb.setLevel(map['reverb_level']);

      volume.setLevel(map['volume_level']);

      delay.setLevel(map['delay_level']);
      delay.setDelayTimer(map['delay_timer']);
      delay.setFeedbackGain(map['delay_feedback_gain']);

      overdrive.setLevel(map['overdrive_level']);
      overdrive.setDrive(map['overdrive_drive']);
      overdrive.setTone(map['overdrive_tone']);

      // stage.stop();
      stage.play('public/sample1.mp3');

      console.log('doit');
    }

    function stopit() {
      stage.stop();

    }



    $("#effects-panel input[type=checkbox]").change(function () {
      if ($(this).prop("checked")) {
        addEffectDiv($(this).prop("id"), $(this).prop("value"));
      } else {
        removeEffectDiv($(this).prop("id"));
      }
    });

    function buildEffectElement(id, name) {
      return '<div ' + 'id="e_' + id + '" class="col-sm-2 text-center"><p>' + name + '</p></div>';
    }

    function addEffectDiv(id, name) {
      var div = buildEffectElement(id, name);
      $("#effects-sequence .panel-body").append(div);
    }

    function removeEffectDiv(id) {
      $('#e_' + id).remove();
    }

</script>

</html>
